# win kubectl

### 本地kubectl

- 默认工作路径：`C:\Users\Administrator\.kube`
- 默认配置文件：`C:\Users\Administrator\.kube\config`

1. 下载kubectl.exe
	```
	https://storage.googleapis.com/kubernetes-release/release/v1.14.3/bin/windows/amd64/kubectl.exe
	```
2. 配置环境变量
	```
	# 我放到了这目录下
	Path=...;D:\Program Files
	```
3. 配置cluster
	```bash
	# 因为用的是域名所以要配置hosts
	edit   C:\Windows\System32\drivers\etc\hosts
	添加   172.16.11.163 apiserver.cluster.local
	
	# 如果方便从集群拷贝ca证书的话，可以通过命令`--certificate-authority`指定ca路径
	# mkdir `C:\Users\Administrator\.kube`  and  拷贝证书进去
	kubectl config set-cluster kubernetes --certificate-authority=ca.crt --server=https://apiserver.cluster.local:6443
	
	# 但拷贝ca太麻烦，直接在linux上base64加密获取想要的值
	cat /etc/kubernetes/pki/ca.crt | base64 --wrap=0
	
	# 修改配文件，把字段`certificate-authority`改成字段`certificate-authority-data`，然后把证书加密后的内容写进去，如下:
	```
	`C:\Users\Administrator\.kube\config`
	```yaml
	apiVersion: v1
	clusters:
	- cluster:
	    certificate-authority-data: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUN5akNDQWJLZ0F3SUJBZ0lCQURBTkJna3Foa2lHOXcwQkFRc0ZBREFWTVJNd0VRWURWUVFERXdwcmRXSmwKY201bGRHVnpNQ0FYRFRFNU1USXhOREE0TkRJd05Wb1lEekl4TVRneE1USXdNRGcwTWpBMVdqQVZNUk13RVFZRApWUVFERXdwcmRXSmxjbTVsZEdWek1JSUJJakFOQmdrcWhraUc5dzBCQVFFRkFBT0NBUThBTUlJQkNnS0NBUUVBCndVUHdGOW9wMHZSTWdsejhoK20vNUcwK00rQWVkNFNJOUJDdW12djVsdCs5aytaQi95NXhrMTk1ckgzZlVhbTQKbUNPVzZ3UGdPMnUzMVd1blZUR0JUYk4yd213Ym91REp4cTF6WkltaVJHY3ZDRTRGcUg1ZWgwU2JRT0FrNGhwNQpFT1VOSXFhem0zeWNtb25aK0dWd1lNU1ZUdGRJZHZDMUxIOWVxZTQwSE9mV2lNM3Ric25RZGJ6U2hFSENpSEdhCmkrMy9mdXAzeGNLSXZ2VUYyK2E0MjE0eGRmUHNqODJXQ3NRVnV6VHBvUFNsSnRWWHA3ZjdFRG01ckxSbjZiRzkKYStpbmRnalo4RzJZQjV5NXpSM1BiRll6dVcyQW5WcTQ5ekVFTWRNS0tNT21Gb3o0UHpWbDczSUtXbHFOUDE3Sgp2L3RVeXFuOGcvRzdmNzlDUHBGaDZ3SURBUUFCb3lNd0lUQU9CZ05WSFE4QkFmOEVCQU1DQXFRd0R3WURWUjBUCkFRSC9CQVV3QXdFQi96QU5CZ2txaGtpRzl3MEJBUXNGQUFPQ0FRRUFGWE5SbFVkcHR5TTYrVUYxVk5MKzY5TkoKVlZWWHF1Zys0cXhTWEtFYS8vc3o1SjBuWG1GajYyR2ovMnZsV3ZxUDNrNGRuWnRwZzh3RU9GajlLNE45cFQ1Ywo2MUpaaG1acldNdW0zMnlnUHpEV29RT2RURDB4aFlTUzlEVkpVWXVOcGI0MDZWWVozc2hleFVjT2NzQjFZY0J6CjdhenpsNm9JcFFQTzdIbHAwVWlpUTlsWGVMOXkxYzYvMUZ2VTFjRllSWUNYSnpWS0ZyZ1VMVGg1VS9yZnEyVUcKTUlIWGNZWE1jZENsYVJUc0UxSVdNbFVkTlRmZXFxYWlOOUp0ZnE2Zk95bmlWTDBUYm84WDN4eUFBUWxjWllKcQpYRUZHam5ONVJnejdDd0twZnl6QjBRb3VOWFNnRHZxVmZKOEZ3b1RiTDVEbmVRUlBuOFhFVWNnQ2pWL2Fkdz09Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K
	    server: https://apiserver.cluster.local:6443
	  name: kubernetes
	contexts: []
	current-context: ""
	kind: Config
	preferences: {}
	users: []

	```
4. 配置用户信息
	```bash
	# help提示可以用`--namespace`，但我感觉意义不是很大，绑定role就可以了
	kubectl config set-context yjx@kubernetes --user=yjx --cluster=kubernetes
	```
	`C:\Users\Administrator\.kube\config`
	```yaml
	apiVersion: v1
	clusters:
	- cluster:
	    certificate-authority-data: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUN5akNDQWJLZ0F3SUJBZ0lCQURBTkJna3Foa2lHOXcwQkFRc0ZBREFWTVJNd0VRWURWUVFERXdwcmRXSmwKY201bGRHVnpNQ0FYRFRFNU1USXhOREE0TkRJd05Wb1lEekl4TVRneE1USXdNRGcwTWpBMVdqQVZNUk13RVFZRApWUVFERXdwcmRXSmxjbTVsZEdWek1JSUJJakFOQmdrcWhraUc5dzBCQVFFRkFBT0NBUThBTUlJQkNnS0NBUUVBCndVUHdGOW9wMHZSTWdsejhoK20vNUcwK00rQWVkNFNJOUJDdW12djVsdCs5aytaQi95NXhrMTk1ckgzZlVhbTQKbUNPVzZ3UGdPMnUzMVd1blZUR0JUYk4yd213Ym91REp4cTF6WkltaVJHY3ZDRTRGcUg1ZWgwU2JRT0FrNGhwNQpFT1VOSXFhem0zeWNtb25aK0dWd1lNU1ZUdGRJZHZDMUxIOWVxZTQwSE9mV2lNM3Ric25RZGJ6U2hFSENpSEdhCmkrMy9mdXAzeGNLSXZ2VUYyK2E0MjE0eGRmUHNqODJXQ3NRVnV6VHBvUFNsSnRWWHA3ZjdFRG01ckxSbjZiRzkKYStpbmRnalo4RzJZQjV5NXpSM1BiRll6dVcyQW5WcTQ5ekVFTWRNS0tNT21Gb3o0UHpWbDczSUtXbHFOUDE3Sgp2L3RVeXFuOGcvRzdmNzlDUHBGaDZ3SURBUUFCb3lNd0lUQU9CZ05WSFE4QkFmOEVCQU1DQXFRd0R3WURWUjBUCkFRSC9CQVV3QXdFQi96QU5CZ2txaGtpRzl3MEJBUXNGQUFPQ0FRRUFGWE5SbFVkcHR5TTYrVUYxVk5MKzY5TkoKVlZWWHF1Zys0cXhTWEtFYS8vc3o1SjBuWG1GajYyR2ovMnZsV3ZxUDNrNGRuWnRwZzh3RU9GajlLNE45cFQ1Ywo2MUpaaG1acldNdW0zMnlnUHpEV29RT2RURDB4aFlTUzlEVkpVWXVOcGI0MDZWWVozc2hleFVjT2NzQjFZY0J6CjdhenpsNm9JcFFQTzdIbHAwVWlpUTlsWGVMOXkxYzYvMUZ2VTFjRllSWUNYSnpWS0ZyZ1VMVGg1VS9yZnEyVUcKTUlIWGNZWE1jZENsYVJUc0UxSVdNbFVkTlRmZXFxYWlOOUp0ZnE2Zk95bmlWTDBUYm84WDN4eUFBUWxjWllKcQpYRUZHam5ONVJnejdDd0twZnl6QjBRb3VOWFNnRHZxVmZKOEZ3b1RiTDVEbmVRUlBuOFhFVWNnQ2pWL2Fkdz09Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K
	    server: https://apiserver.cluster.local:6443
	  name: kubernetes
	contexts:
	- context:
	    cluster: kubernetes
	    user: yjx
	  name: yjx@kubernetes
	current-context: ""
	kind: Config
	preferences: {}
	users: []

	```
5. 配置用户认证信息
	```bash
	# 我在linux上执行的命令
	# CN表示user，O表示Group  在绑定权限的时候最好绑定group  最好做到group做权限user做认证
	openssl genrsa -out yjx.key 2048
	openssl req -new -key yjx.key -out yjx.csr -subj "/CN=yjx/O=test"
	openssl x509 -req -in yjx.csr -CA /etc/kubernetes/pki/ca.crt -CAkey /etc/kubernetes/pki/ca.key -CAcreateserial -out yjx.crt -days 3650
	cat yjx.crt | base64 --wrap=0
    cat yjx.key | base64 --wrap=0
    
    # 如果方便拷贝的话把`yjx.key`和`yjx.crt`拷贝到`C:\Users\Administrator\.kube`
    kubectl config set-credentials yjx --certificate-authority=ca.crt --embed-certs=true --client-key=yjx.key --client-certificate=yjx.crt
    
    # 如果不方便的话，只能手动改配置文件
    kubectl config set-credentials yjx --client-certificate-data=LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUNyakNDQVpZQ0NRRHJ3YVorRTdZQlREQU5CZ2txaGtpRzl3MEJBUXNGQURBVk1STXdFUVlEVlFRREV3cHIKZFdKbGNtNWxkR1Z6TUI0WERUSXdNREl3TlRBMU1EQTFNVm9YRFRNd01ESXdNakExTURBMU1Wb3dIVEVNTUFvRwpBMVVFQXd3RGVXcDRNUTB3Q3dZRFZRUUtEQVIwWlhOME1JSUJJakFOQmdrcWhraUc5dzBCQVFFRkFBT0NBUThBCk1JSUJDZ0tDQVFFQXI2L01Mc25sMjAreS9Oc3Z1WDJtYlJiMU5ZQzNmK1FuUWFMNit2TXpSa0MzQXRSZG0rbUYKNjErWmd2REQvZ1BTOWhUK20xV1hib3dHaDhPV05HcnpDZXFHUktjNEovZXZ4OFNaTlZZaHZOc0dTRVl3WU84QgpCeHVEUG9ydW1ydStHblM1MFZmWW1taCs5S0pKQmRnSlM1ZFZzY1JYdkpWbmpTZktYWExNU0s5cWZmdlVkM2pHCllRREgwbDBXUkFNcWEyQlBhTW5wRHZJU3RYcThNNVRidkN4TXBiSEFMZmNEMWlGSVlJRVhuNmhzMEFCd0VrT0YKc3ZWd3RrT1ZSMXdtZFF5bFlPajMreVMrMnJ4LzEvdy9SWjd1eGgyK28rbUJobHJYVmJKNmZJN1hqL3F1MjFCZgpNZ1F3a2tvakxHVEs0aEJ3UDhzSEZWSW4yNnZ2UDZVVUN3SURBUUFCTUEwR0NTcUdTSWIzRFFFQkN3VUFBNElCCkFRQUxkMStNcThKSlVuNUl2by9QZDc2bXlaRkxGRWxvMVZmTWRlanF4L20xa25vWlJzR002eVdGYkZwTzc1ZHYKcm9pOXdSL3dJVUVkTlo0U0M1WFMvamRsQzBUQlR1djBQZnRMWVpkZStvck9vb3lqdDE0YTh5ODlWM1daaU9yRgpPWGlDZklPNG4xWUk0OWxSNFRZVU5RbklNT2hEM0NuV1Fyd2t6QklEMWliQ2VMUU1NOUVmUEhYQm1GVkpVNGdrCmNBbERFTUtUQnBKY0gwV28rUFFWWDFrT0dCcEJDZXR6SlRVaVB2eU5Xb1I0OU9jeXJQVUw0Mlc1RzZleXpvUzAKdzBZcE4zOUJZdXBwUkpLUHhIaEpYRjdxT25HcHl5bXBjeU5PemJBZVF0ZHlLTFQ2RnRsYlVxUHkxSFhpZXd4ZwpqeXhRYkVlSEtDWHQySXA4VzB1K0dDKzUKLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQo=  --client-key-data=LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQpNSUlFb3dJQkFBS0NBUUVBcjYvTUxzbmwyMCt5L05zdnVYMm1iUmIxTllDM2YrUW5RYUw2K3ZNelJrQzNBdFJkCm0rbUY2MStaZ3ZERC9nUFM5aFQrbTFXWGJvd0doOE9XTkdyekNlcUdSS2M0Si9ldng4U1pOVllodk5zR1NFWXcKWU84QkJ4dURQb3J1bXJ1K0duUzUwVmZZbW1oKzlLSkpCZGdKUzVkVnNjUlh2SlZualNmS1hYTE1TSzlxZmZ2VQpkM2pHWVFESDBsMFdSQU1xYTJCUGFNbnBEdklTdFhxOE01VGJ2Q3hNcGJIQUxmY0QxaUZJWUlFWG42aHMwQUJ3CkVrT0ZzdlZ3dGtPVlIxd21kUXlsWU9qMyt5UysycngvMS93L1JaN3V4aDIrbyttQmhsclhWYko2Zkk3WGovcXUKMjFCZk1nUXdra29qTEdUSzRoQndQOHNIRlZJbjI2dnZQNlVVQ3dJREFRQUJBb0lCQUZRc0R0QnY3TStKUE1FRwpwclBoTG1aZnRIWEF5S25lZnF4azBJaUJFcFRiRnBPbGVYL2tmMFFJMW55MHE4STh4TXNmdmVoZ05xQkJPRE85CmttNWt1ektLQ1hCRkNaT2tpTFJXVGUwTzZqVVlYc2NyMGF2dmRuZVlSK1lrSEROSU5jbHBHVW5pSTZXKzRPeUcKQUNScm4vQjJmaGtnYjhTcmRDUmQ1d2VrbzVsQ25ubjQ1eVppd2ZQZWRlS2Y4NjJ1UDJnVS9QYll6SExMbWdkawpPVEhTNHJmbWU3SS9Scjk4V3ZYNE1kb1QyNEJEaC85SUUrT2RtNHhuSkVDUEZvZE1ZNXVjY0F5WGJVOUo5S2xrClVJZ0RZckhkMGdBYjFFVzM3UFJuQ0daVHVKblJqTmR5ekhsbGpnTE5CSnNLUktnT0ZCeU1MaEhKM3AyRXc5SVoKVUtUa3V4RUNnWUVBM21tUkgzQXFXN3lXdHBTWnBNWXF0TUNlVUd1ZVMxVUpuMVNYYW1jSXMrZFNKeno4cGhzMQpYa0JnekNtYjhpQnJYV3FzR1ZzQzBRZmFObWZOcGwxYk15eHFyTzdBQ2RFU2pZV0E5VWswKzFRdkc3aldIaFZ4Cng3VVRPdmlYNzByb21TOFRDWkxqalNvMnRNRjNxdTA5MEYwa01LdFRCQXYrTXVUMHRubWxYdU1DZ1lFQXlqZlMKb0RwQmhoS0pCTVFyUjNEVmNUaUxxK0NZZVdoSFRDVkxja3dIYzIzUnhySkQ0U0kvSEpQQzRqbGdReG1jQ3J2WApkczBHbEt6cEpWcjdLYXVtTndjdDFQemRlVlVWdFFUM0dzSm5sMElDakpYQm9LQWNBNVdWS0NOUU4ySXhIbDZQClNGNUlpem5RVHpuTmhmTVBzU0M2Q1ZBaE9nakZPOURGRzgvVUZya0NnWUFLRTJ4QXFWc3g1cnhKTHpnNnI4T1YKaHJobFdrckVqT2l2c0N4ZjVLVVBTV1orWXBQcmpvWC9iQmsyaHBnTEF3NzZIM0FHZ2dvQm9FSnhmb2hoaGc4dwpwVTE3NGlFUEVNcXZZS0h6K3NvTXJNYXBrZGtaYWMxS3g5aEVMcWpyYlZCV1NEeXJqVjBEc3lyaFMzWjVadUFMCkJYMHpPeis2aWpTTTU3UnlZOVpyRXdLQmdEUTFKVlBvdG5IKzV4RXI5R0NGYVJYS0c0Vk1meEVaTXc4ZHNkVFkKZkRQNDdtZjJMa0E1cjBHWmhIOFRnUjdSeGMrZm40azBkYlo4emRTdklKa3BqOGcxT2tmNjROTXFmR2czMS9RNApyTFlJZk0vKytmYVdYNlV0UVUwVGtPbzdsNkxYbHZhQUlRcVE2bzhKeFY0SDJzMUlQYitaeUhwTE9XQ3dEYk9ZCmZKRkJBb0dCQUwwc1dMK1FyaFc1QmJtSnMrbGYyaW1OQWpNSUZyeFFXcWorMHd1cEV2RHgycXgwU3h1Y0xJZUwKUkZ2WFk1Ky85SFBLSU9acXJtMDl3UDJkTkFjU29SaExzWU85SkVaM2VFWi9mMG9jK0lLY3dhWExHTzc4K2MvdQpZRmdFUldDVEV4MTNqeWU3c3FDTzFLVDNDWnJKejR3bVJFMEluTjRiRjhLR3oyNnpPK1pCCi0tLS0tRU5EIFJTQSBQUklWQVRFIEtFWS0tLS0tCg==
	```
	`C:\Users\Administrator\.kube\config`
	```yaml
	apiVersion: v1
	clusters:
	- cluster:
	    certificate-authority-data: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUN5akNDQWJLZ0F3SUJBZ0lCQURBTkJna3Foa2lHOXcwQkFRc0ZBREFWTVJNd0VRWURWUVFERXdwcmRXSmwKY201bGRHVnpNQ0FYRFRFNU1USXhOREE0TkRJd05Wb1lEekl4TVRneE1USXdNRGcwTWpBMVdqQVZNUk13RVFZRApWUVFERXdwcmRXSmxjbTVsZEdWek1JSUJJakFOQmdrcWhraUc5dzBCQVFFRkFBT0NBUThBTUlJQkNnS0NBUUVBCndVUHdGOW9wMHZSTWdsejhoK20vNUcwK00rQWVkNFNJOUJDdW12djVsdCs5aytaQi95NXhrMTk1ckgzZlVhbTQKbUNPVzZ3UGdPMnUzMVd1blZUR0JUYk4yd213Ym91REp4cTF6WkltaVJHY3ZDRTRGcUg1ZWgwU2JRT0FrNGhwNQpFT1VOSXFhem0zeWNtb25aK0dWd1lNU1ZUdGRJZHZDMUxIOWVxZTQwSE9mV2lNM3Ric25RZGJ6U2hFSENpSEdhCmkrMy9mdXAzeGNLSXZ2VUYyK2E0MjE0eGRmUHNqODJXQ3NRVnV6VHBvUFNsSnRWWHA3ZjdFRG01ckxSbjZiRzkKYStpbmRnalo4RzJZQjV5NXpSM1BiRll6dVcyQW5WcTQ5ekVFTWRNS0tNT21Gb3o0UHpWbDczSUtXbHFOUDE3Sgp2L3RVeXFuOGcvRzdmNzlDUHBGaDZ3SURBUUFCb3lNd0lUQU9CZ05WSFE4QkFmOEVCQU1DQXFRd0R3WURWUjBUCkFRSC9CQVV3QXdFQi96QU5CZ2txaGtpRzl3MEJBUXNGQUFPQ0FRRUFGWE5SbFVkcHR5TTYrVUYxVk5MKzY5TkoKVlZWWHF1Zys0cXhTWEtFYS8vc3o1SjBuWG1GajYyR2ovMnZsV3ZxUDNrNGRuWnRwZzh3RU9GajlLNE45cFQ1Ywo2MUpaaG1acldNdW0zMnlnUHpEV29RT2RURDB4aFlTUzlEVkpVWXVOcGI0MDZWWVozc2hleFVjT2NzQjFZY0J6CjdhenpsNm9JcFFQTzdIbHAwVWlpUTlsWGVMOXkxYzYvMUZ2VTFjRllSWUNYSnpWS0ZyZ1VMVGg1VS9yZnEyVUcKTUlIWGNZWE1jZENsYVJUc0UxSVdNbFVkTlRmZXFxYWlOOUp0ZnE2Zk95bmlWTDBUYm84WDN4eUFBUWxjWllKcQpYRUZHam5ONVJnejdDd0twZnl6QjBRb3VOWFNnRHZxVmZKOEZ3b1RiTDVEbmVRUlBuOFhFVWNnQ2pWL2Fkdz09Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K
	    server: https://apiserver.cluster.local:6443
	  name: kubernetes
	contexts: []
	current-context: ""
	kind: Config
	preferences: {}
	users:
	- name: yjx
	  user:
	    client-certificate-data: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUNyakNDQVpZQ0NRRHJ3YVorRTdZQlREQU5CZ2txaGtpRzl3MEJBUXNGQURBVk1STXdFUVlEVlFRREV3cHIKZFdKbGNtNWxkR1Z6TUI0WERUSXdNREl3TlRBMU1EQTFNVm9YRFRNd01ESXdNakExTURBMU1Wb3dIVEVNTUFvRwpBMVVFQXd3RGVXcDRNUTB3Q3dZRFZRUUtEQVIwWlhOME1JSUJJakFOQmdrcWhraUc5dzBCQVFFRkFBT0NBUThBCk1JSUJDZ0tDQVFFQXI2L01Mc25sMjAreS9Oc3Z1WDJtYlJiMU5ZQzNmK1FuUWFMNit2TXpSa0MzQXRSZG0rbUYKNjErWmd2REQvZ1BTOWhUK20xV1hib3dHaDhPV05HcnpDZXFHUktjNEovZXZ4OFNaTlZZaHZOc0dTRVl3WU84QgpCeHVEUG9ydW1ydStHblM1MFZmWW1taCs5S0pKQmRnSlM1ZFZzY1JYdkpWbmpTZktYWExNU0s5cWZmdlVkM2pHCllRREgwbDBXUkFNcWEyQlBhTW5wRHZJU3RYcThNNVRidkN4TXBiSEFMZmNEMWlGSVlJRVhuNmhzMEFCd0VrT0YKc3ZWd3RrT1ZSMXdtZFF5bFlPajMreVMrMnJ4LzEvdy9SWjd1eGgyK28rbUJobHJYVmJKNmZJN1hqL3F1MjFCZgpNZ1F3a2tvakxHVEs0aEJ3UDhzSEZWSW4yNnZ2UDZVVUN3SURBUUFCTUEwR0NTcUdTSWIzRFFFQkN3VUFBNElCCkFRQUxkMStNcThKSlVuNUl2by9QZDc2bXlaRkxGRWxvMVZmTWRlanF4L20xa25vWlJzR002eVdGYkZwTzc1ZHYKcm9pOXdSL3dJVUVkTlo0U0M1WFMvamRsQzBUQlR1djBQZnRMWVpkZStvck9vb3lqdDE0YTh5ODlWM1daaU9yRgpPWGlDZklPNG4xWUk0OWxSNFRZVU5RbklNT2hEM0NuV1Fyd2t6QklEMWliQ2VMUU1NOUVmUEhYQm1GVkpVNGdrCmNBbERFTUtUQnBKY0gwV28rUFFWWDFrT0dCcEJDZXR6SlRVaVB2eU5Xb1I0OU9jeXJQVUw0Mlc1RzZleXpvUzAKdzBZcE4zOUJZdXBwUkpLUHhIaEpYRjdxT25HcHl5bXBjeU5PemJBZVF0ZHlLTFQ2RnRsYlVxUHkxSFhpZXd4ZwpqeXhRYkVlSEtDWHQySXA4VzB1K0dDKzUKLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQo=
	    client-key-data: LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQpNSUlFb3dJQkFBS0NBUUVBcjYvTUxzbmwyMCt5L05zdnVYMm1iUmIxTllDM2YrUW5RYUw2K3ZNelJrQzNBdFJkCm0rbUY2MStaZ3ZERC9nUFM5aFQrbTFXWGJvd0doOE9XTkdyekNlcUdSS2M0Si9ldng4U1pOVllodk5zR1NFWXcKWU84QkJ4dURQb3J1bXJ1K0duUzUwVmZZbW1oKzlLSkpCZGdKUzVkVnNjUlh2SlZualNmS1hYTE1TSzlxZmZ2VQpkM2pHWVFESDBsMFdSQU1xYTJCUGFNbnBEdklTdFhxOE01VGJ2Q3hNcGJIQUxmY0QxaUZJWUlFWG42aHMwQUJ3CkVrT0ZzdlZ3dGtPVlIxd21kUXlsWU9qMyt5UysycngvMS93L1JaN3V4aDIrbyttQmhsclhWYko2Zkk3WGovcXUKMjFCZk1nUXdra29qTEdUSzRoQndQOHNIRlZJbjI2dnZQNlVVQ3dJREFRQUJBb0lCQUZRc0R0QnY3TStKUE1FRwpwclBoTG1aZnRIWEF5S25lZnF4azBJaUJFcFRiRnBPbGVYL2tmMFFJMW55MHE4STh4TXNmdmVoZ05xQkJPRE85CmttNWt1ektLQ1hCRkNaT2tpTFJXVGUwTzZqVVlYc2NyMGF2dmRuZVlSK1lrSEROSU5jbHBHVW5pSTZXKzRPeUcKQUNScm4vQjJmaGtnYjhTcmRDUmQ1d2VrbzVsQ25ubjQ1eVppd2ZQZWRlS2Y4NjJ1UDJnVS9QYll6SExMbWdkawpPVEhTNHJmbWU3SS9Scjk4V3ZYNE1kb1QyNEJEaC85SUUrT2RtNHhuSkVDUEZvZE1ZNXVjY0F5WGJVOUo5S2xrClVJZ0RZckhkMGdBYjFFVzM3UFJuQ0daVHVKblJqTmR5ekhsbGpnTE5CSnNLUktnT0ZCeU1MaEhKM3AyRXc5SVoKVUtUa3V4RUNnWUVBM21tUkgzQXFXN3lXdHBTWnBNWXF0TUNlVUd1ZVMxVUpuMVNYYW1jSXMrZFNKeno4cGhzMQpYa0JnekNtYjhpQnJYV3FzR1ZzQzBRZmFObWZOcGwxYk15eHFyTzdBQ2RFU2pZV0E5VWswKzFRdkc3aldIaFZ4Cng3VVRPdmlYNzByb21TOFRDWkxqalNvMnRNRjNxdTA5MEYwa01LdFRCQXYrTXVUMHRubWxYdU1DZ1lFQXlqZlMKb0RwQmhoS0pCTVFyUjNEVmNUaUxxK0NZZVdoSFRDVkxja3dIYzIzUnhySkQ0U0kvSEpQQzRqbGdReG1jQ3J2WApkczBHbEt6cEpWcjdLYXVtTndjdDFQemRlVlVWdFFUM0dzSm5sMElDakpYQm9LQWNBNVdWS0NOUU4ySXhIbDZQClNGNUlpem5RVHpuTmhmTVBzU0M2Q1ZBaE9nakZPOURGRzgvVUZya0NnWUFLRTJ4QXFWc3g1cnhKTHpnNnI4T1YKaHJobFdrckVqT2l2c0N4ZjVLVVBTV1orWXBQcmpvWC9iQmsyaHBnTEF3NzZIM0FHZ2dvQm9FSnhmb2hoaGc4dwpwVTE3NGlFUEVNcXZZS0h6K3NvTXJNYXBrZGtaYWMxS3g5aEVMcWpyYlZCV1NEeXJqVjBEc3lyaFMzWjVadUFMCkJYMHpPeis2aWpTTTU3UnlZOVpyRXdLQmdEUTFKVlBvdG5IKzV4RXI5R0NGYVJYS0c0Vk1meEVaTXc4ZHNkVFkKZkRQNDdtZjJMa0E1cjBHWmhIOFRnUjdSeGMrZm40azBkYlo4emRTdklKa3BqOGcxT2tmNjROTXFmR2czMS9RNApyTFlJZk0vKytmYVdYNlV0UVUwVGtPbzdsNkxYbHZhQUlRcVE2bzhKeFY0SDJzMUlQYitaeUhwTE9XQ3dEYk9ZCmZKRkJBb0dCQUwwc1dMK1FyaFc1QmJtSnMrbGYyaW1OQWpNSUZyeFFXcWorMHd1cEV2RHgycXgwU3h1Y0xJZUwKUkZ2WFk1Ky85SFBLSU9acXJtMDl3UDJkTkFjU29SaExzWU85SkVaM2VFWi9mMG9jK0lLY3dhWExHTzc4K2MvdQpZRmdFUldDVEV4MTNqeWU3c3FDTzFLVDNDWnJKejR3bVJFMEluTjRiRjhLR3oyNnpPK1pCCi0tLS0tRU5EIFJTQSBQUklWQVRFIEtFWS0tLS0tCg==
	
	```

### 集群RBAC

外部用户使用主要通过user和group，serviceaccount主要是给内部服务用的。

1. 添加RBAC(想做的更细的话比如apigroups可以通过yaml文件去指定)
2. 创建role
	```bash
	kubectl create role pod-reader --verb=get,list,watch --resource=pods -n public-service
	kubectl create role pod-reader --verb=get,list,watch --resource=pods
	```
3. 创建rolebiding将role和group绑定
	```bash

	kubectl create rolebinding yjx-pod-reader --role=pod-reader --group=test -n public-service
	kubectl create rolebinding yjx-pod-reader --role=pod-reader --group=test
	```
4. 本地kubectl切换用户并验证
	```bash
	PS C:\Users\Administrator> kubectl config use-context yjx@kubernetes

	PS C:\Users\Administrator> kubectl get po -n public-service
	NAME                             READY   STATUS    RESTARTS   AGE
	gitlab-ldap-m8j2z                1/1     Running   0          26d
	ldap-7cbb67657c-fvvkd            1/1     Running   0          26d
	nginx-auth-ldap-b6fc4c7d-cmwq4   1/1     Running   0          26d
	phpldapadmin-b8db9d476-9blcc     1/1     Running   0          30d
	postgresql-qnnr9                 1/1     Running   0          26d
	redis-gl4zh                      1/1     Running   0          30d

	PS C:\Users\Administrator> kubectl get po
	NAME                                            READY   STATUS              RESTARTS   AGE
	billowing-mouse-drone-server-79f7987954-fclcp   0/1     ContainerCreating   0          26d
	dex-8678d4d85f-t77r9                            1/1     Running             0          14d
	nfs-provisioner-54d96cbc87-qjgbx                1/1     Running             0          27d

	PS C:\Users\Administrator> kubectl get po -n kube-system
	Error from server (Forbidden): pods is forbidden: User "yjx" cannot list resource "pods" in API group "" in the namespac
	e "kube-system"
	```
	这时候本机kubeconfig文件`C:\Users\Administrator\.kube\config`多了`current-context`
	```yaml
	apiVersion: v1
	clusters:
	- cluster:
	    certificate-authority-data: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUN5akNDQWJLZ0F3SUJBZ0lCQURBTkJna3Foa2lHOXcwQkFRc0ZBREFWTVJNd0VRWURWUVFERXdwcmRXSmwKY201bGRHVnpNQ0FYRFRFNU1USXhOREE0TkRJd05Wb1lEekl4TVRneE1USXdNRGcwTWpBMVdqQVZNUk13RVFZRApWUVFERXdwcmRXSmxjbTVsZEdWek1JSUJJakFOQmdrcWhraUc5dzBCQVFFRkFBT0NBUThBTUlJQkNnS0NBUUVBCndVUHdGOW9wMHZSTWdsejhoK20vNUcwK00rQWVkNFNJOUJDdW12djVsdCs5aytaQi95NXhrMTk1ckgzZlVhbTQKbUNPVzZ3UGdPMnUzMVd1blZUR0JUYk4yd213Ym91REp4cTF6WkltaVJHY3ZDRTRGcUg1ZWgwU2JRT0FrNGhwNQpFT1VOSXFhem0zeWNtb25aK0dWd1lNU1ZUdGRJZHZDMUxIOWVxZTQwSE9mV2lNM3Ric25RZGJ6U2hFSENpSEdhCmkrMy9mdXAzeGNLSXZ2VUYyK2E0MjE0eGRmUHNqODJXQ3NRVnV6VHBvUFNsSnRWWHA3ZjdFRG01ckxSbjZiRzkKYStpbmRnalo4RzJZQjV5NXpSM1BiRll6dVcyQW5WcTQ5ekVFTWRNS0tNT21Gb3o0UHpWbDczSUtXbHFOUDE3Sgp2L3RVeXFuOGcvRzdmNzlDUHBGaDZ3SURBUUFCb3lNd0lUQU9CZ05WSFE4QkFmOEVCQU1DQXFRd0R3WURWUjBUCkFRSC9CQVV3QXdFQi96QU5CZ2txaGtpRzl3MEJBUXNGQUFPQ0FRRUFGWE5SbFVkcHR5TTYrVUYxVk5MKzY5TkoKVlZWWHF1Zys0cXhTWEtFYS8vc3o1SjBuWG1GajYyR2ovMnZsV3ZxUDNrNGRuWnRwZzh3RU9GajlLNE45cFQ1Ywo2MUpaaG1acldNdW0zMnlnUHpEV29RT2RURDB4aFlTUzlEVkpVWXVOcGI0MDZWWVozc2hleFVjT2NzQjFZY0J6CjdhenpsNm9JcFFQTzdIbHAwVWlpUTlsWGVMOXkxYzYvMUZ2VTFjRllSWUNYSnpWS0ZyZ1VMVGg1VS9yZnEyVUcKTUlIWGNZWE1jZENsYVJUc0UxSVdNbFVkTlRmZXFxYWlOOUp0ZnE2Zk95bmlWTDBUYm84WDN4eUFBUWxjWllKcQpYRUZHam5ONVJnejdDd0twZnl6QjBRb3VOWFNnRHZxVmZKOEZ3b1RiTDVEbmVRUlBuOFhFVWNnQ2pWL2Fkdz09Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K
	    server: https://apiserver.cluster.local:6443
	  name: kubernetes
	contexts:
	- context:
	    cluster: kubernetes
	    user: yjx
	  name: yjx@kubernetes
	current-context: yjx@kubernetes
	kind: Config
	preferences: {}
	users:
	- name: yjx
	  user:
	    client-certificate-data: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUNyakNDQVpZQ0NRRHJ3YVorRTdZQlREQU5CZ2txaGtpRzl3MEJBUXNGQURBVk1STXdFUVlEVlFRREV3cHIKZFdKbGNtNWxkR1Z6TUI0WERUSXdNREl3TlRBMU1EQTFNVm9YRFRNd01ESXdNakExTURBMU1Wb3dIVEVNTUFvRwpBMVVFQXd3RGVXcDRNUTB3Q3dZRFZRUUtEQVIwWlhOME1JSUJJakFOQmdrcWhraUc5dzBCQVFFRkFBT0NBUThBCk1JSUJDZ0tDQVFFQXI2L01Mc25sMjAreS9Oc3Z1WDJtYlJiMU5ZQzNmK1FuUWFMNit2TXpSa0MzQXRSZG0rbUYKNjErWmd2REQvZ1BTOWhUK20xV1hib3dHaDhPV05HcnpDZXFHUktjNEovZXZ4OFNaTlZZaHZOc0dTRVl3WU84QgpCeHVEUG9ydW1ydStHblM1MFZmWW1taCs5S0pKQmRnSlM1ZFZzY1JYdkpWbmpTZktYWExNU0s5cWZmdlVkM2pHCllRREgwbDBXUkFNcWEyQlBhTW5wRHZJU3RYcThNNVRidkN4TXBiSEFMZmNEMWlGSVlJRVhuNmhzMEFCd0VrT0YKc3ZWd3RrT1ZSMXdtZFF5bFlPajMreVMrMnJ4LzEvdy9SWjd1eGgyK28rbUJobHJYVmJKNmZJN1hqL3F1MjFCZgpNZ1F3a2tvakxHVEs0aEJ3UDhzSEZWSW4yNnZ2UDZVVUN3SURBUUFCTUEwR0NTcUdTSWIzRFFFQkN3VUFBNElCCkFRQUxkMStNcThKSlVuNUl2by9QZDc2bXlaRkxGRWxvMVZmTWRlanF4L20xa25vWlJzR002eVdGYkZwTzc1ZHYKcm9pOXdSL3dJVUVkTlo0U0M1WFMvamRsQzBUQlR1djBQZnRMWVpkZStvck9vb3lqdDE0YTh5ODlWM1daaU9yRgpPWGlDZklPNG4xWUk0OWxSNFRZVU5RbklNT2hEM0NuV1Fyd2t6QklEMWliQ2VMUU1NOUVmUEhYQm1GVkpVNGdrCmNBbERFTUtUQnBKY0gwV28rUFFWWDFrT0dCcEJDZXR6SlRVaVB2eU5Xb1I0OU9jeXJQVUw0Mlc1RzZleXpvUzAKdzBZcE4zOUJZdXBwUkpLUHhIaEpYRjdxT25HcHl5bXBjeU5PemJBZVF0ZHlLTFQ2RnRsYlVxUHkxSFhpZXd4ZwpqeXhRYkVlSEtDWHQySXA4VzB1K0dDKzUKLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQo=
	    client-key-data: LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQpNSUlFb3dJQkFBS0NBUUVBcjYvTUxzbmwyMCt5L05zdnVYMm1iUmIxTllDM2YrUW5RYUw2K3ZNelJrQzNBdFJkCm0rbUY2MStaZ3ZERC9nUFM5aFQrbTFXWGJvd0doOE9XTkdyekNlcUdSS2M0Si9ldng4U1pOVllodk5zR1NFWXcKWU84QkJ4dURQb3J1bXJ1K0duUzUwVmZZbW1oKzlLSkpCZGdKUzVkVnNjUlh2SlZualNmS1hYTE1TSzlxZmZ2VQpkM2pHWVFESDBsMFdSQU1xYTJCUGFNbnBEdklTdFhxOE01VGJ2Q3hNcGJIQUxmY0QxaUZJWUlFWG42aHMwQUJ3CkVrT0ZzdlZ3dGtPVlIxd21kUXlsWU9qMyt5UysycngvMS93L1JaN3V4aDIrbyttQmhsclhWYko2Zkk3WGovcXUKMjFCZk1nUXdra29qTEdUSzRoQndQOHNIRlZJbjI2dnZQNlVVQ3dJREFRQUJBb0lCQUZRc0R0QnY3TStKUE1FRwpwclBoTG1aZnRIWEF5S25lZnF4azBJaUJFcFRiRnBPbGVYL2tmMFFJMW55MHE4STh4TXNmdmVoZ05xQkJPRE85CmttNWt1ektLQ1hCRkNaT2tpTFJXVGUwTzZqVVlYc2NyMGF2dmRuZVlSK1lrSEROSU5jbHBHVW5pSTZXKzRPeUcKQUNScm4vQjJmaGtnYjhTcmRDUmQ1d2VrbzVsQ25ubjQ1eVppd2ZQZWRlS2Y4NjJ1UDJnVS9QYll6SExMbWdkawpPVEhTNHJmbWU3SS9Scjk4V3ZYNE1kb1QyNEJEaC85SUUrT2RtNHhuSkVDUEZvZE1ZNXVjY0F5WGJVOUo5S2xrClVJZ0RZckhkMGdBYjFFVzM3UFJuQ0daVHVKblJqTmR5ekhsbGpnTE5CSnNLUktnT0ZCeU1MaEhKM3AyRXc5SVoKVUtUa3V4RUNnWUVBM21tUkgzQXFXN3lXdHBTWnBNWXF0TUNlVUd1ZVMxVUpuMVNYYW1jSXMrZFNKeno4cGhzMQpYa0JnekNtYjhpQnJYV3FzR1ZzQzBRZmFObWZOcGwxYk15eHFyTzdBQ2RFU2pZV0E5VWswKzFRdkc3aldIaFZ4Cng3VVRPdmlYNzByb21TOFRDWkxqalNvMnRNRjNxdTA5MEYwa01LdFRCQXYrTXVUMHRubWxYdU1DZ1lFQXlqZlMKb0RwQmhoS0pCTVFyUjNEVmNUaUxxK0NZZVdoSFRDVkxja3dIYzIzUnhySkQ0U0kvSEpQQzRqbGdReG1jQ3J2WApkczBHbEt6cEpWcjdLYXVtTndjdDFQemRlVlVWdFFUM0dzSm5sMElDakpYQm9LQWNBNVdWS0NOUU4ySXhIbDZQClNGNUlpem5RVHpuTmhmTVBzU0M2Q1ZBaE9nakZPOURGRzgvVUZya0NnWUFLRTJ4QXFWc3g1cnhKTHpnNnI4T1YKaHJobFdrckVqT2l2c0N4ZjVLVVBTV1orWXBQcmpvWC9iQmsyaHBnTEF3NzZIM0FHZ2dvQm9FSnhmb2hoaGc4dwpwVTE3NGlFUEVNcXZZS0h6K3NvTXJNYXBrZGtaYWMxS3g5aEVMcWpyYlZCV1NEeXJqVjBEc3lyaFMzWjVadUFMCkJYMHpPeis2aWpTTTU3UnlZOVpyRXdLQmdEUTFKVlBvdG5IKzV4RXI5R0NGYVJYS0c0Vk1meEVaTXc4ZHNkVFkKZkRQNDdtZjJMa0E1cjBHWmhIOFRnUjdSeGMrZm40azBkYlo4emRTdklKa3BqOGcxT2tmNjROTXFmR2czMS9RNApyTFlJZk0vKytmYVdYNlV0UVUwVGtPbzdsNkxYbHZhQUlRcVE2bzhKeFY0SDJzMUlQYitaeUhwTE9XQ3dEYk9ZCmZKRkJBb0dCQUwwc1dMK1FyaFc1QmJtSnMrbGYyaW1OQWpNSUZyeFFXcWorMHd1cEV2RHgycXgwU3h1Y0xJZUwKUkZ2WFk1Ky85SFBLSU9acXJtMDl3UDJkTkFjU29SaExzWU85SkVaM2VFWi9mMG9jK0lLY3dhWExHTzc4K2MvdQpZRmdFUldDVEV4MTNqeWU3c3FDTzFLVDNDWnJKejR3bVJFMEluTjRiRjhLR3oyNnpPK1pCCi0tLS0tRU5EIFJTQSBQUklWQVRFIEtFWS0tLS0tCg==
	
	```
